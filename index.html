<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miniature Paint Matcher</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{font-family:'Outfit',sans-serif}
.gradient-bg{background:linear-gradient(135deg,#1e1b4b 0%,#312e81 50%,#3730a3 100%)}
.glass-card{background:rgba(255,255,255,.95);backdrop-filter:blur(10px)}
.paint-swatch:hover{transform:scale(1.05);transition:.2s}
.upload-zone{border:2px dashed #6366f1}
.color-marker{cursor:grab;position:absolute;width:30px;height:30px;border-radius:999px;border:3px solid white;box-shadow:0 5px 15px rgba(0,0,0,.3)}
.color-marker:active{cursor:grabbing}
</style>
</head>

<body class="gradient-bg min-h-screen p-6">

<div class="max-w-7xl mx-auto">

<header class="flex justify-between items-center mb-6">
<h1 class="text-3xl font-bold text-white">Paint Matcher</h1>
<div class="flex gap-2 bg-white/10 p-1 rounded-xl">
<button onclick="switchView('matcher')" id="tab-matcher" class="px-5 py-2 rounded-lg bg-indigo-600 text-white">ðŸŽ¨ Color Matcher</button>
<button onclick="switchView('inventory')" id="tab-inventory" class="px-5 py-2 rounded-lg text-white/70 hover:bg-white/10">ðŸ“¦ My Inventory</button>
</div>
</header>

<!-- MATCHER -->
<div id="view-matcher" class="flex gap-6">

<div class="flex-1 glass-card rounded-2xl p-6 relative">
<div id="upload-zone" class="upload-zone rounded-xl flex items-center justify-center h-96 cursor-pointer">
<label class="cursor-pointer text-center">
<p class="text-lg font-medium text-indigo-600">Upload reference image</p>
<input type="file" id="image-upload" accept="image/*" hidden>
</label>
</div>

<div id="image-container" class="hidden relative h-96 rounded-xl overflow-hidden">
<canvas id="image-canvas" class="absolute inset-0"></canvas>
<div id="markers-container" class="absolute inset-0"></div>
<button onclick="addMarker()" class="absolute bottom-4 left-4 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow">Add Color</button>
<button onclick="clearImage()" class="absolute bottom-4 right-4 bg-white px-4 py-2 rounded-lg shadow">Change</button>
</div>
</div>

<div class="w-96 glass-card rounded-2xl p-6 overflow-y-auto">
<h2 class="text-lg font-semibold mb-4">Color Matches</h2>
<div id="color-matches" class="space-y-4 text-gray-400 text-center">
No colors selected
</div>
</div>

</div>

<!-- INVENTORY -->
<div id="view-inventory" class="hidden glass-card rounded-2xl p-6">
<h2 class="text-lg font-semibold mb-4">My Paint Collection</h2>

<div class="grid grid-cols-6 gap-3" id="inventory-grid"></div>

<div class="mt-6 flex gap-3 items-end">
<select id="new-brand" class="border px-3 py-2 rounded-lg">
<option value="citadel">Citadel</option>
<option value="vallejo">Vallejo</option>
<option value="army_painter">Army Painter</option>
<option value="pro_acryl">Pro Acryl</option>
</select>
<input id="new-name" placeholder="Paint name" class="border px-3 py-2 rounded-lg flex-1">
<input type="color" id="new-color" value="#ff0000" class="h-10 w-16">
<button onclick="addPaint()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg">Add</button>
</div>
</div>

</div>

<script>

// ==================== DATABASE ====================

const PAINT_DATABASE = {
citadel:[{name:"Mephiston Red",hex:"#9a1115"},{name:"Abaddon Black",hex:"#231f20"}],
vallejo:[{name:"Scarlet Red",hex:"#bc140c"}],
army_painter:[{name:"Dragon Red",hex:"#be1b10"}],
pro_acryl:[{name:"Bold Titanium White",hex:"#ffffff"}]
};

// ==================== INVENTORY ====================

const STORAGE_KEY="paint_inventory_v1";
let inventory=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");

function saveInventory(){localStorage.setItem(STORAGE_KEY,JSON.stringify(inventory));}

function renderInventory(){
const grid=document.getElementById("inventory-grid");
if(!inventory.length){grid.innerHTML="<p class='text-gray-400 col-span-6'>No paints yet</p>";return;}
grid.innerHTML=inventory.map(p=>`
<div class="paint-swatch bg-white p-3 rounded-xl shadow text-center">
<div class="aspect-square rounded mb-2" style="background:${p.hex}"></div>
<p class="text-sm font-medium">${p.name}</p>
</div>`).join("");
}

function addPaint(){
const name=document.getElementById("new-name").value;
const brand=document.getElementById("new-brand").value;
const hex=document.getElementById("new-color").value;
if(!name)return;
inventory.push({name,brand,hex});
saveInventory();
renderInventory();
document.getElementById("new-name").value="";
}

// ==================== VIEW ====================

function switchView(view){
document.getElementById("view-matcher").classList.toggle("hidden",view!=="matcher");
document.getElementById("view-inventory").classList.toggle("hidden",view!=="inventory");
document.getElementById("tab-matcher").classList.toggle("bg-indigo-600",view==="matcher");
document.getElementById("tab-inventory").classList.toggle("bg-indigo-600",view==="inventory");
if(view==="inventory")renderInventory();
}

// ==================== IMAGE + MARKERS ====================

let image=null;
let markers=[];

const uploadZone=document.getElementById("upload-zone");
const imageUpload=document.getElementById("image-upload");

uploadZone.onclick=()=>imageUpload.click();
imageUpload.onchange=e=>{
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=ev=>{
image=new Image();
image.onload=drawImage;
image.src=ev.target.result;
};
reader.readAsDataURL(file);
};

function drawImage(){
document.getElementById("upload-zone").classList.add("hidden");
document.getElementById("image-container").classList.remove("hidden");
const canvas=document.getElementById("image-canvas");
const ctx=canvas.getContext("2d");
canvas.width=canvas.clientWidth;
canvas.height=canvas.clientHeight;
ctx.drawImage(image,0,0,canvas.width,canvas.height);
}

function clearImage(){
markers=[];
document.getElementById("markers-container").innerHTML="";
document.getElementById("image-container").classList.add("hidden");
document.getElementById("upload-zone").classList.remove("hidden");
document.getElementById("color-matches").innerHTML="No colors selected";
}

function addMarker(){
const container=document.getElementById("markers-container");
const marker=document.createElement("div");
marker.className="color-marker";
marker.style.left="50%";
marker.style.top="50%";
container.appendChild(marker);

makeDraggable(marker);
sampleColor(marker);
markers.push(marker);
}

function makeDraggable(marker){
let dragging=false,startX,startY,startLeft,startTop;

marker.onmousedown=e=>{
dragging=true;
startX=e.clientX;
startY=e.clientY;
startLeft=marker.offsetLeft;
startTop=marker.offsetTop;
};

document.onmousemove=e=>{
if(!dragging)return;
marker.style.left=startLeft+(e.clientX-startX)+"px";
marker.style.top=startTop+(e.clientY-startY)+"px";
sampleColor(marker);
};

document.onmouseup=()=>dragging=false;
}

function sampleColor(marker){
const canvas=document.getElementById("image-canvas");
const ctx=canvas.getContext("2d");
const x=marker.offsetLeft+15;
const y=marker.offsetTop+15;
try{
const pixel=ctx.getImageData(x,y,1,1).data;
const hex=rgbToHex(pixel[0],pixel[1],pixel[2]);
marker.style.backgroundColor=hex;
updateMatches();
}catch{}
}

function updateMatches(){
const container=document.getElementById("color-matches");
if(!markers.length){container.innerHTML="No colors selected";return;}

container.innerHTML=markers.map((m,i)=>{
const hex=m.style.backgroundColor;
const matches=findClosest(hex);
return`
<div class="bg-gray-50 p-4 rounded-xl">
<div class="flex items-center gap-3 mb-2">
<div class="w-8 h-8 rounded shadow" style="background:${hex}"></div>
<p class="font-semibold">${hex}</p>
</div>
${matches.map(match=>`
<div class="flex items-center gap-2 text-sm">
<div class="w-6 h-6 rounded" style="background:${match.hex}"></div>
<span>${match.name}</span>
</div>`).join("")}
</div>`;
}).join("");
}

function findClosest(hex){
const target=hexToRgb(hex);
let paints=[];
for(const [brand,list] of Object.entries(PAINT_DATABASE)){
list.forEach(p=>{
const dist=colorDistance(target,hexToRgb(p.hex));
paints.push({...p,dist});
});
}
return paints.sort((a,b)=>a.dist-b.dist).slice(0,3);
}

function colorDistance(a,b){
return Math.sqrt((a.r-b.r)**2+(a.g-b.g)**2+(a.b-b.b)**2);
}

function hexToRgb(hex){
const res=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
return res?{r:parseInt(res[1],16),g:parseInt(res[2],16),b:parseInt(res[3],16)}:{r:0,g:0,b:0};
}

function rgbToHex(r,g,b){
return"#"+[r,g,b].map(x=>x.toString(16).padStart(2,"0")).join("");
}

</script>
</body>
</html>
